{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
 <link rel="stylesheet" href="{% static 'css/styleguide.css' %}">
 <link rel="stylesheet" href="{% static 'css/global.css' %}">
 <link rel="stylesheet" href="{% static 'css/login.css' %}">
 
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ورود</title>
  
</head>
<body>
  <div class="frame">
    <div class="overlap-group">
      <img class="download" src="{% static 'image/download (1) 1.svg' %}" />
      <img class="image" src="{% static 'image/image2 1.svg' %}" />

      <div class="div" id="login-form">
        <form id="loginForm">
          <div class="div-2">
            <input class="text-wrapper" id="username" name="username" placeholder="نام کاربری">
            <hr>
          </div>
          <div class="div-3">
            <input class="text-wrapper-2" id="password" name="password" placeholder="رمز عبور" type="password">
            <hr>
          </div>

          <div class="frame-wrapper">
            <div class="div-wrapper">
              <div class="div-4">
                <div class="div-5">
                  <div class="fluent-color"><img class="group" src="{% static 'image/Group.svg' %}" /></div>
                  <div class="div-wrapper-2">
                    <p class="p">
                      <span class="span">رمز عبور را </span>
                      <a class="text-wrapper-3">به خاطر </a>
                      <span class="span">داشته باش</span>
                    </p>
                  </div>
                </div>
                <div class="frame-wrapper-2">
                  <div class="div-wrapper-3">
                    <p class="p">
                      <span class="text-wrapper-4">رمز عبور را </span>
                      <a class="text-wrapper-3" id="reset-password">فراموش</a>
                      <span class="text-wrapper-4"> کرده‌اید؟</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="div-6">
            <form method="post" action="/login/">
  {% csrf_token %}
  <input name="username" />
  <input name="password" type="password" />
  <button type="submit">ورود</button>
</form>
            <p class="div-7">
              <span class="span">حساب کاربری ندارید؟&nbsp;همین الان </span>
              <a class="text-wrapper-3" href="/register/">ثبت نام</a>
              <span class="span"> کنید</span>
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      fetch("http://127.0.0.1:8000/api/login/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ username, password })
      })
      .then(res => res.json().then(data => {
        if (res.ok) {
          localStorage.setItem("token", data.token);
          alert("ورود موفق!");
          window.location.href="/karino/";
        } else {
          throw new Error(data.detail || "ورود ناموفق");
        }
      }))
      .catch(err => {
        alert("خطا: " + err.message);
      });
    });
    
  </script>
</body>
</html>
